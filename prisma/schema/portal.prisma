// 生産管理システム用Prismaスキーマ
// ai-agent-direction.mdの規約に従って設計

// 製品マスター
model Product {
 id        Int       @id @default(autoincrement())
 createdAt DateTime  @default(now())
 updatedAt DateTime? @updatedAt()
 sortOrder Float     @default(0)

 name               String // 商品名
 color              String // カラー
 cost               Int // コスト（税抜）
 productionCapacity Int // 生産能力（枚/人・時）
 allowanceStock     Int // 余裕在庫数（枚）

 // リレーション
 ProductRecipe ProductRecipe[]
 Order         Order[]
 Production    Production[]
 Shipment      Shipment[]
}

// 原材料マスター
model RawMaterial {
 id        Int       @id @default(autoincrement())
 createdAt DateTime  @default(now())
 updatedAt DateTime? @updatedAt()
 sortOrder Float     @default(0)

 name        String // 名称
 category    String // カテゴリ（例：カラーチップ、ヒーター線など）
 unit        String // 単位（g, 個など）
 cost        Int // コスト（税抜）
 safetyStock Int // 安全在庫数

 // リレーション
 ProductRecipe   ProductRecipe[]
 StockAdjustment StockAdjustment[]
}

// 製品レシピ（製品と原材料の関連）
model ProductRecipe {
 id        Int       @id @default(autoincrement())
 createdAt DateTime  @default(now())
 updatedAt DateTime? @updatedAt()
 sortOrder Float     @default(0)

 productId     Int
 rawMaterialId Int
 amount        Int // 使用量

 // リレーション
 Product     Product     @relation(fields: [productId], references: [id], onDelete: Cascade)
 RawMaterial RawMaterial @relation(fields: [rawMaterialId], references: [id], onDelete: Cascade)

 @@unique([productId, rawMaterialId], name: "product_rawMaterial_unique")
}

// 受注データ
model Order {
 id        Int       @id @default(autoincrement())
 createdAt DateTime  @default(now())
 updatedAt DateTime? @updatedAt()
 sortOrder Float     @default(0)

 orderAt   DateTime // 受注日
 productId Int
 quantity  Int // 受注枚数
 amount    Int // 売上金額（受注日時点の商品マスターのコストに基づき自動計算）
 note      String? // 備考（フリーテキスト）

 // リレーション
 Product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

// 生産データ
model Production {
 id        Int       @id @default(autoincrement())
 createdAt DateTime  @default(now())
 updatedAt DateTime? @updatedAt()
 sortOrder Float     @default(0)

 productionAt DateTime // 生産日
 productId    Int
 quantity     Int // 生産枚数
 type         String // 生産区分（国産または中国産）
 note         String? // 備考（フリーテキスト）

 // リレーション
 Product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

// 出荷データ
model Shipment {
 id        Int       @id @default(autoincrement())
 createdAt DateTime  @default(now())
 updatedAt DateTime? @updatedAt()
 sortOrder Float     @default(0)

 shipmentId String // ユニークな識別子（バーコードなど）
 shipmentAt DateTime // 出荷日
 productId  Int
 quantity   Int // 出荷数
 note       String? // 備考（フリーテキスト）

 // リレーション
 Product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

// 在庫調整（原材料の入荷・廃棄など）
model StockAdjustment {
 id        Int       @id @default(autoincrement())
 createdAt DateTime  @default(now())
 updatedAt DateTime? @updatedAt()
 sortOrder Float     @default(0)

 rawMaterialId Int
 adjustmentAt  DateTime // 調整日
 reason        String // 理由（入荷、廃棄、サンプル使用、棚卸差異など）
 quantity      Int // 数量（入荷は正、その他は負）

 // リレーション
 RawMaterial RawMaterial @relation(fields: [rawMaterialId], references: [id], onDelete: Cascade)
}

// 会社カレンダー（休日設定）
model CompanyHoliday {
 id        Int       @id @default(autoincrement())
 createdAt DateTime  @default(now())
 updatedAt DateTime? @updatedAt()
 sortOrder Float     @default(0)

 holidayAt   DateTime @unique // 日付
 holidayType String   @default("休日") // 休日種別（休日、祝日、夏季休暇など）
 note        String? // 備考
}
