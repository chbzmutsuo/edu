// ===================================================================
// カウンセリング予約管理システム - Prismaスキーマ
// ===================================================================

// 店舗マスタ
model CounselingStore {
 id        Int       @id @default(autoincrement())
 createdAt DateTime  @default(now())
 updatedAt DateTime? @updatedAt
 sortOrder Float     @default(0)

 name           String // 店舗名（例：大阪店、名古屋店）
 // リレーション
 Room           CounselingRoom[]
 User           User[]
 CounselingSlot CounselingSlot[]
}

// 部屋マスタ
model CounselingRoom {
 id                Int       @id @default(autoincrement())
 createdAt         DateTime  @default(now())
 updatedAt         DateTime? @updatedAt
 sortOrder         Float     @default(0)
 name              String // 部屋名（例：510号室、Aルーム）
 counselingStoreId Int // 所属店舗ID

 // リレーション
 CounselingStore CounselingStore  @relation(fields: [counselingStoreId], references: [id], onDelete: Cascade)
 CounselingSlot  CounselingSlot[]
}

// お客様マスタ
model CounselingClient {
 id         Int       @id @default(autoincrement())
 createdAt  DateTime  @default(now())
 updatedAt  DateTime? @updatedAt
 sortOrder  Float     @default(0)
 name       String // お名前
 furigana   String? // ふりがな
 phone      String    @unique // 電話番号（一意制約）
 email      String? // メールアドレス
 gender     String? // 性別
 age        String? // 年齢（年代）
 prefecture String? // 都道府県
 address    String? // 住所（市区町村まで）

 // リレーション
 CounselingReservation CounselingReservation[]
}

// 予約情報
model CounselingReservation {
 id        Int       @id @default(autoincrement())
 createdAt DateTime  @default(now())
 updatedAt DateTime? @updatedAt
 sortOrder Float     @default(0)

 status        String // ステータス（unassigned | confirmed | completed | canceled）
 preferredDate DateTime? // 希望日（YYYY-MM-DD形式）
 visitorType   String? // 来られる方（1人 | 2人）
 topics        String? // ご相談内容（JSON配列形式）
 notes         String? // 備考・その他の情報
 paymentMethod String? // 支払い方法（カード | 振込 | 現金 など）
 contactMethod String? // 連絡方法（email | phone）

 // リレーション
 CounselingClient   CounselingClient @relation(fields: [counselingClientId], references: [id], onDelete: Cascade)
 counselingClientId Int // お客様ID

 CounselingSlot   CounselingSlot? @relation(fields: [counselingSlotId], references: [id], onDelete: SetNull)
 counselingSlotId Int? // 割り当てられたスロットID（未割り当ての場合null）
}

// 提供可能枠（スロット）
model CounselingSlot {
 id        Int       @id @default(autoincrement())
 createdAt DateTime  @default(now())
 updatedAt DateTime? @updatedAt
 sortOrder Float     @default(0)

 startAt DateTime // 開始日時（UTC）
 endAt   DateTime // 終了日時（UTC）

 // リレーション
 CounselingRoom   CounselingRoom @relation(fields: [counselingRoomId], references: [id], onDelete: Cascade)
 counselingRoomId Int // 部屋ID

 CounselingStore   CounselingStore @relation(fields: [counselingStoreId], references: [id], onDelete: Cascade)
 counselingStoreId Int // 店舗ID（検索の高速化のため非正規化）

 User   User? @relation(fields: [userId], references: [id], onDelete: SetNull)
 userId Int? // 担当カウンセラーID（未定の場合null）

 CounselingReservation CounselingReservation[]
}
