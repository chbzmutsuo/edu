# カウンセリング予約管理システム 要件定義書

## 1. はじめに

### 1.1. 目的

この資料は、カウンセリング業務の予約受付からスケジュール管理、日報作成、実績集計までを一元化し、業務全体の効率化とサービス品質の向上を実現するための新しい管理システムの要件を定義するものです。

### 1.2. システム構成

本システムは、主に以下の機能群で構成されます。

- **初期設定機能** (マスタ登録、提供可能枠の設定)
- **日常業務機能** (予約フォーム、スケジュール管理、スタッフマイページ)
- **分析機能** (実績・集計)

## 2. 導入と初期設定

本システムをスムーズに利用開始するために、まず初めに必要となる基本的な情報設定（マスタ登録）と、予約を受け付けるための準備（提供可能枠の設定）について定義します。

### 2.1. システム利用開始までの流れ

1. **【STEP1】 マスタ設定:** まず、基本情報となる「店舗」「部屋」「カウンセラー」を登録します。
2. **【STEP2】 提供可能枠の設定:** 次に、スケジュール管理画面で、どのカウンセラーが「いつ」「どの部屋で」対応可能かを設定します。
3. **【STEP3】 運用開始:** 上記の設定が完了次第、お客様向けの予約フォームが利用可能となり、日常の予約管理業務を開始できます。

### 2.2. マスタ設定画面

### 2.2.1. 概要

システムを運用する上で最も基本となる情報（マスターデータ）を登録・編集するための、管理者向けのページです。**システム利用開始時に、まず初めに設定を行う必要があります。**

### 2.2.2. 主な管理項目

- **店舗管理:** 新しい店舗ができた際に店舗情報を追加したり、既存の店舗情報を変更したりできます。（例：大阪店、名古屋店）
- **部屋管理:** 各店舗に所属するカウンセリングルームの情報を登録・編集できます。（例：大阪店の510号室）
- **カウンセラー管理:** 新しいスタッフが入社した際にアカウントを登録したり、既存スタッフの情報（氏名、メールアドレス、所属店舗など）を更新したり、権限（管理者/一般）を設定したりします。
  - カウンセラーは**店舗を跨がない**構造で管理。特定の店舗で予約が入った場合、その店舗に所属するカウンセラーのみが選択肢として表示されるように。

- **お客様管理:** 予約時に自動作成されたお客様マスタ情報を閲覧、編集します。

### 2.3. 提供可能枠（スケジュール）の設定

### 2.3.1. 概要

お客様からの予約を受け付けるための「枠」を定義する機能です。この設定は「**スケジュール管理画面**」上で行います。

### 2.3.2. 主な機能

- **提供可能枠（Availability）の作成・編集・削除**
  - スケジュール管理画面にて「提供枠追加」を実施可能。
    - 以下の項目を選択し、枠を一括生成
      - 担当カウンセラー（空欄として、枠のみの作成も可能。）
      - 1枠あたりの時間（初期値：60分）
      - 曜日
      - 開始
      - 終了時間
    - 作成された枠は、枠単位でクリックすることで詳細情報を編集可能にする。
      - 担当カウンセラー
      - 予約を紐付け
      - 削除
      - 日時変更
    - コーディングにあたっては、「1枠」を表すSlotコンポーネントを作る
      - 開始時間、終了時間、予約ID(nullable)、担当カウンセラーID（nullable）を引数に取る。
      - クリックすることで、モーダルを表示
        - 詳細情報
        - 枠の削除（予約が紐づいている場合は削除不可）
        - 詳細情報の変更
          - 予約紐付け
          - 枠の日時変更：変更先にすでに枠があったら変更不可。
          - カウンセラー変更
        - 予約がある場合は、下記の情報
          - クライアント名
          - 過去の予約回数、キャンセル回数
          - 担当カウンセラー
          - 日時、部屋の変更
          - 予約のキャンセル処理

- **重複登録の防止**
  - 同じ部屋・同じ時間帯に、複数のカウンセラーの提供枠が重複して設定されることをシステム側で自動的に防止します。

## 3. 日常業務の画面

初期設定完了後、日々の業務で使用する画面の要件を定義します。

### 3.1. 予約フォーム画面

### 3.1.1. 概要

カウンセリングを受けたいお客様が、PCやスマートフォンから24時間365日、いつでも予約を申し込むことができる公開ページです。

### 3.1.2. 画面の動き

1. お客様は希望の店舗と日付をカレンダーから選択します。
2. システムは、選択された日に予約可能な時間帯の一覧を自動で表示します。これは「提供可能枠」によります。（同じ店舗であれば部屋を問わない）
3. お客様は希望の時間を選択し、お客様情報を入力して「予約を申し込む」ボタンを押します。
4. システムは入力内容を「未対応の予約」としてデータベースに保存します。
5. お客様の画面に「ご予約ありがとうございます。予約確定の連絡をお待ちください。」という完了メッセージを表示します。

### 3.1.3. 表示・入力項目

- **店舗選択**（必須, プルダウン形式）
- **ご希望日時**（必須, カレンダーおよび時間選択形式）
- **お名前**（必須, テキスト入力）
- **メールアドレス**（必須, テキスト入力）
- **電話番号**（必須, テキスト入力）
- **年齢**（年代をプルダウン選択）
- **ご住所**（市区町村まで, テキスト入力）
- **予約回数**（「初めて」/「2回目以降」のラジオボタン）
- **ご相談内容**（複数選択可能なチェックボックス）
- **備考**（自由入力欄）
- **予約申込ボタン**

> 💡 補足事項：予約フォーム関連
>
> - **お客様マスタの自動作成**
>   - 初回予約時、入力された情報（特に**電話番号**）を基にお客様マスタデータを新規に作成します。
>   - 過去に同じ「電話番号」で予約されたことがあるお客様は「継続」とみなし、マスタデータは作成せず既存データに紐付けます。
> - **予約枠の制御**
>   - お客様が選択できる日時は、事前に設定された**提供可能枠（Availability）**から、既に予約済みの時間を除外したもののみです。
>   - **新規予約の制限:** 新規のお客様が土日を希望する場合、予約操作日から**6日以内**の日付のみ選択可能とします。
> - **通知機能**
>   - **スタッフへの通知:** 予約申込が完了した時点で、指定された**ChatWork**の「予約申込通知」ルームに通知を送信します。この機能は後で実装するため、ログ出力のみとします。
>   - **お客様への通知:** 申込完了後、お客様のメールアドレス宛に「仮予約完了」の自動返信メールを送信します。この機能は後で実装するため、ログ出力のみとします。
> - **ログの収集**
>   - 予約フォームへのアクセスおよび予約申込完了時に、以下の情報をログとして記録します。
>     - **アクセス日時**
>     - **IPアドレス**
> - **リマインド機能**
>   - 予約日の前日18:00に、お客様のメールアドレス宛にリマインドメールを自動送信します。

### 3.2. スケジュール管理画面

### 3.2.1. 概要

管理者やスタッフが、システム全体の予約状況を視覚的に把握し、お客様からの新しい予約申込に対応するための中心的な管理画面です。

### 3.2.2. 主な機能

- **月間タイムテーブル表示**
  - 縦軸に「時間」、横軸に「日付」をとったカレンダー形式で、どの部屋がいつ使われているかが視覚的に分かります。
  - 提供可能枠（空き枠）、確定予約、仮予約などが色分けされて表示されます。
- **予約の割り当て**
  - 画面サイドバーに表示される「未対応の予約」一覧から、お客様の申込情報を空いている提供可能枠に割り当て、予約を確定させます。
    - 予約枠をクリックすると、画面が暗転し、サイドバーにある「未対応の予約一覧」がハイライト
    - 対象となる「未対応の予約」を選択することで枠への割り当てが可能に

- **予約の確認・変更・キャンセル**
  - タイムテーブル上の予約情報をクリックすると、詳細モーダルが開き、以下の情報を確認・編集できます。
    - クライアント名
    - 過去の予約回数、キャンセル回数
    - 担当カウンセラー
    - 日時、部屋の変更
    - 予約のキャンセル処理
- **表示フィルター**
  - 「大阪店の510号室だけ見たい」といった場合に、表示する店舗や部屋をチェックボックスで動的に絞り込むことができます。

### 3.3. スタッフマイページ画面

### 3.3.1. 概要

カウンセラーが自身の業務をスムーズに進めるための専用ページです。PCまたはスマートフォンからログインして使用します。

### 3.3.2. 主な機能

- **スケジュール確認**
  - ログインしているカウンセラー自身の予約スケジュールが、**1ヶ月単位のカレンダー形式（5週×7日）**で表示されます。
  - 日付をクリックすると、その日の予約が時系列で一覧表示されます。
- **実施確定**
  - カウンセリング完了後、「実施確定」ボタンを押してステータスを「完了」に変更します。
  - 確定時に、支払い方法（現金/カード/振込など）を選択・記録できます。
- **次回予約の登録**
  - 完了したカウンセリングのお客様名をクリックすると、その場で次回の予約を登録するためのモーダルウィンドウが開き、空き状況を確認しながらスムーズに次回予約を確保できます。
  - この時、設定された提供可能枠を指定して直接予約データを作成します。
- **日報の作成・送信**
  - その日の業務終了後、「日報作成」ボタンから作成画面を開きます。
  - **売上報告:** 実施したカウンセリング一覧と、記録した支払い方法が自動で表示されます。
  - **報告・連絡事項:** テキストで自由入力が可能です。
  - 「送信」ボタンで、作成した日報を管理者に提出します。

> 💡 補足事項：マイページ関連
>
> - **リマインド機能:** 予約日の前日18:00に、担当カウンセラーのメールアドレス（Gmail）宛に、翌日の担当スケジュールを通知するリマインドメールを自動送信します。

## 4. 実績と分析：このページは今回のデモでは実装しない

### 4.1. 実績・集計画面

### 4.1.1. 概要

店舗の運営状況を様々な角度から分析するためのデータを、グラフや表で分かりやすく可視化するページです。経営判断や業務改善に活用します。

### 4.1.2. 主な集計項目

- **予約申込集計:** 店舗別・月別の予約数、キャンセル数、実質予約数など。
- **カウンセリング数:** カウンセラー別、新規/再来別のカウンセリング数。
- **通院状況:** カウンセラーごとの、お客様の継続回数に関する詳細な分析表。
- **各種推移グラフ:** 月別予約数、新規予約受付数、個人別平均回数などの推移をグラフで表示。

> 💡 補足事項：実績・集計関連
>
> - **データ移行:** 原則として、本システムの運用開始後のデータが集計対象となります。過去データの移行については、工数と費用を考慮し別途協議とします。
> - **CSV出力機能:** 全ての集計表およびグラフの元データは、CSV形式でダウンロードできる機能を有します。
